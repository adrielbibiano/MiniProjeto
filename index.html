<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Previs√£o do Tempo 5 Dias</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estiliza√ß√£o para o gradiente de fundo */
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #1e3a8a 0%, #0c4a6e 100%);
            min-height: 100vh;
            color: #e5e7eb;
        }
        /* Efeito de hover nos cards */
        .weather-card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .weather-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container mx-auto p-4 sm:p-8">
        <header class="text-center py-6 mb-8 bg-white/10 backdrop-blur-sm rounded-xl shadow-lg">
            <h1 class="text-4xl sm:text-5xl font-extold text-white">
                Previs√£o do Tempo 5 Dias
            </h1>
            <p class="mt-2 text-xl text-indigo-300" id="city-display">Carregando dados...</p>
        </header>

        <div id="loading-message" class="text-center text-xl mt-12">
            <svg class="animate-spin h-8 w-8 text-white mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Conectando com a API...
        </div>

        <div id="weather-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-6 mt-10">
            </div>
        
        <footer class="text-center mt-12 p-4 text-sm text-white/50">
            <p>Arquitetura: Front-end -> Sua API (Express) -> PostgreSQL -> OpenWeather API.</p>
            <p>Para ver os dados, execute a rota de atualiza√ß√£o (POST /api/clima/atualizar) primeiro.</p>
        </footer>
    </div>

    <script>
        // Usando caminho RELATIVO. Isso garante que funcionar√° em qualquer URL de deploy (Render).
        const API_RECENT_URL = 'api/clima/recentes';
        
        // Fun√ß√£o para obter o √≠cone (simulando a l√≥gica da OpenWeather)
        function getIcon(code) {
            // Mapeamento simples dos c√≥digos OpenWeather para Emojis
            if (!code) return '‚ùì';
            if (code.includes('01')) return '‚òÄÔ∏è'; // C√©u Limpo
            if (code.includes('02')) return 'üå§Ô∏è'; // Poucas Nuvens
            if (code.includes('03') || code.includes('04')) return '‚òÅÔ∏è'; // Nuvens
            if (code.includes('09') || code.includes('10')) return 'üåßÔ∏è'; // Chuva
            if (code.includes('11')) return 'üå©Ô∏è'; // Tempestade
            if (code.includes('13')) return '‚ùÑÔ∏è'; // Neve
            if (code.includes('50')) return 'üå´Ô∏è'; // N√©voa
            return 'üå°Ô∏è';
        }

        // Fun√ß√£o para criar o HTML de um cart√£o de clima
        function createWeatherCard(data) {
            const icon = getIcon(data.icone);
            
            return `
                <div class="weather-card p-6 bg-white/10 rounded-2xl shadow-xl border border-white/20 backdrop-blur-lg">
                    <div class="text-center">
                        <p class="text-xl font-semibold text-indigo-300 capitalize">${data.data}</p>
                        <p class="text-sm text-white/70">${data.hora}</p>
                    </div>
                    <div class="my-4 text-7xl text-center">${icon}</div>
                    <div class="text-center">
                        <p class="text-5xl font-bold text-white">${data.temperatura}</p>
                        <p class="text-lg mt-2 text-indigo-200">${data.condicao}</p>
                        <p class="text-md mt-4 font-light text-white/90">${data.local}</p>
                    </div>
                </div>
            `;
        }

        // Fun√ß√£o principal para buscar e renderizar os dados
        async function fetchAndRenderWeather() {
            const container = document.getElementById('weather-container');
            const loadingMessage = document.getElementById('loading-message');
            const cityDisplay = document.getElementById('city-display');
            
            loadingMessage.classList.remove('hidden'); 
            container.innerHTML = ''; 

            try {
                // A requisi√ß√£o usa o caminho relativo.
                const response = await fetch(API_RECENT_URL); 
                
                if (!response.ok) {
                    throw new Error(`Erro de HTTP: ${response.status} - Falha ao comunicar com o servidor.`);
                }

                const json = await response.json();

                if (json.dados && json.dados.length > 0) {
                    let htmlContent = '';
                    // Mapeia e renderiza os dados
                    json.dados.forEach(data => {
                        htmlContent += createWeatherCard(data);
                    });
                    
                    container.innerHTML = htmlContent;
                    
                    const cityName = json.dados[0].local;
                    cityDisplay.textContent = `Resultados para: ${cityName}`;

                } else {
                     // Exibe mensagem de DB vazio
                     container.innerHTML = `
                        <div class="col-span-full text-center p-8 bg-blue-800/50 rounded-lg shadow-2xl">
                            <h2 class="text-2xl font-bold mb-2 text-blue-300">Banco de Dados Vazio</h2>
                            <p class="text-lg text-blue-100">N√£o h√° dados recentes de clima no PostgreSQL.</p>
                            <p class="mt-4 text-blue-200">Voc√™ precisar√° enviar uma requisi√ß√£o POST para /api/clima/atualizar para popular o banco.</p>
                        </div>
                    `;
                    cityDisplay.textContent = 'Aguardando dados...';
                }

            } catch (error) {
                // Exibe erro de conex√£o/API
                container.innerHTML = `
                    <div class="col-span-full text-center p-8 bg-red-800/50 rounded-lg shadow-2xl">
                        <h2 class="text-2xl font-bold mb-2 text-red-300">Erro de Aplica√ß√£o</h2>
                        <p class="text-lg text-red-100">O servidor Express pode n√£o estar configurado corretamente ou o PostgreSQL n√£o est√° acess√≠vel.</p>
                        <p class="mt-4 text-red-200">${error.message}</p>
                    </div>
                `;
                cityDisplay.textContent = 'Falha ao carregar dados.';
                console.error("Erro ao buscar dados da API:", error);
            } finally {
                loadingMessage.classList.add('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', fetchAndRenderWeather);
    </script>
</body>
</html>
